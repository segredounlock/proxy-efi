# Bot Telegram A12+ - Configuração Otimizada
# Evita 403, permite Telegram, mantém segurança

AddHandler application/x-httpd-php .php

# Desabilitar ModSecurity
<IfModule mod_security.c>
    SecRuleEngine Off
</IfModule>

# ======================================
# PERMITIR WEBHOOKS
# ======================================

<Files "api_telegram.php">
    Require all granted
</Files>

<Files "api_telegram_FINAL.php">
    Require all granted
</Files>

<Files "bot_unico_completo.php">
    Require all granted
</Files>

<Files "webhook.php">
    Require all granted
</Files>

<Files "setup_webhook.php">
    Require all granted
</Files>

<Files "test_webhook_access.php">
    Require all granted
</Files>

<Files "CHECK_BOT.php">
    Require all granted
</Files>

# ======================================
# PERMITIR USER-AGENTS DO TELEGRAM
# ======================================

<IfModule mod_rewrite.c>
    RewriteEngine On
    # Permitir Telegram Bot API
    RewriteCond %{HTTP_USER_AGENT} ^TelegramBot [NC]
    RewriteRule ^ - [L]
    
    # Bloquear apenas bots maliciosos (não Telegram)
    RewriteCond %{HTTP_USER_AGENT} (libwww-perl|wget|nikto|scan|winhttp|clshttp|loader) [NC]
    RewriteRule ^(.*)$ - [F,L]
</IfModule>

# ======================================
# PROTEGER DADOS
# ======================================

<DirectoryMatch "(bot_data|bot_logs)">
    Require all denied
</DirectoryMatch>

<FilesMatch "\.(json|lock|log)$">
    Require all denied
</FilesMatch>

<FilesMatch "^\.">
    Require all denied
</FilesMatch>

<FilesMatch "\.(ini|conf|config|bak|backup|old|save|swp|tmp)$">
    Require all denied
</FilesMatch>

# ======================================
# SEGURANÇA
# ======================================

Options -Indexes
ServerSignature Off

<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "DENY"
    Header set X-XSS-Protection "1; mode=block"
    Header unset X-Powered-By
</IfModule>

# ======================================
# LIMITES
# ======================================

<LimitExcept GET POST>
    Require all denied
</LimitExcept>

php_value upload_max_filesize 2M
php_value post_max_size 2M

# ======================================
# COMPRESSÃO E CACHE
# ======================================

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/css text/javascript application/javascript application/json
</IfModule>

<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/html "access plus 0 seconds"
</IfModule>

AddDefaultCharset UTF-8
